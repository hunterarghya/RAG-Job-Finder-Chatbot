<!doctype html>
<html>
  <body>
    <h2>Register</h2>

    <form id="reg">
      <input name="name" placeholder="name" /><br />
      <input name="email" placeholder="email" /><br />
      <input name="password" type="password" placeholder="password" /><br />
      <button>Register</button>
    </form>

    <h2>Login</h2>

    <form id="login">
      <input id="email" placeholder="email" /><br />
      <input id="password" type="password" placeholder="password" /><br />
      <button>Login</button>
    </form>

    <script>
      // =============== REGISTER =================
      document.getElementById("reg").onsubmit = async (e) => {
        e.preventDefault();
        const f = e.target;

        const res = await fetch("/auth/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: f.name.value,
            email: f.email.value,
            password: f.password.value,
          }),
        });

        const j = await res.json();
        if (j.access_token) {
          localStorage.setItem("token", j.access_token);
          location.href = "/static/dashboard.html";
        } else alert(JSON.stringify(j));
      };

      // =============== LOGIN =================
      document.getElementById("login").onsubmit = async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value;
        const pass = document.getElementById("password").value;

        const fd = new FormData();
        fd.append("username", email);
        fd.append("password", pass);

        const res = await fetch("/auth/login", {
          method: "POST",
          body: fd,
        });

        const j = await res.json();

        if (j.access_token) {
          localStorage.setItem("token", j.access_token);
          location.href = "/static/dashboard.html";
        } else alert(JSON.stringify(j));
      };
    </script>
  </body>
</html>
